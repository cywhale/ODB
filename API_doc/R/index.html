<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="cywhale cyrain＠gmail.com" />

<meta name="date" content="2019-07-04" />

<title>BioQuery API</title>

<script src="site_libs/jquery/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap/shim/respond.min.js"></script>
<script src="site_libs/navigation/tabsets.js"></script>




<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">BioQuery API</h1>
<h4 class="author">cywhale cyrain＠gmail.com</h4>
<h4 class="date">2019-07-04</h4>

</div>


<p>Open API to get statitical results from bio-database, ODB, Institute of Oceanography, NTU.<br />
The API is in development stage and documentation is under construction. Updates will be continued.<br />
Now the bioquery API have following functions:</p>
<ul>
<li>bioquery<br />
</li>
<li>geo2map<br />
</li>
<li>geo2wwwmap<br />
</li>
<li>txt2geojson<br />
</li>
<li>site_intersect</li>
</ul>
<div id="open-api.01" class="section level1 tabset tabset-fade tabset-pills">
<h1>Open API.01</h1>
<hr />
<div id="post" class="section level2">
<h2>POST</h2>
<hr />
<p><a name="api01">keyword: </a> <em>bioquery site2map</em></p>
<p><strong>API cURL url: </strong><a href="https://bio.odb.ntu.edu.tw/api/bioquery/png" class="uri">https://bio.odb.ntu.edu.tw/api/bioquery/png</a> {jpeg, pdf, svg}</p>
<p>site2map can plot sites, polygons, and overaly of environmental layer.<br />
Basically it calls geo2map API, and can be incorporated with query<br />
criteria from BioQuery web applications in bio.odb.ntu.edu.tw/query</p>
<hr />
</div>
<div id="body" class="section level2">
<h2>Body</h2>
<hr />
<p><span class="docs-request-body__mode push-half--left">formdata</span></p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td>
config
</td>
<td>
<div class="pm-markdown docs-request-table__desc">
<p>
Query crieteria downloaded from BioQuery: bio.odb.ntu.edu.tw/query, or a config text, json, or yaml file.
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
return_type
</td>
<td>
“site2map”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
return data type, here, “site2map” can return png, jpeg, svg, or pdf
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
legend_pos
</td>
<td>
“bottom”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional. Legend positon: “none” (no legend) “bottomright”, “topleft”, “right”, “bottom”, and so on
</p>
</div>
</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="curl" class="section level2">
<h2>cURL</h2>
<p><span class="docs-example__snippet-type"><a name="curl01">Example Request: </a></span><span class="docs-example__response-title" title="bioquery site2map">bioquery site2map</span></p>
<pre><code>curl --location --request POST &quot;https://bio.odb.ntu.edu.tw/api/bioquery/png&quot; \   
  --form &quot;config=@Your_File_Path&quot; \
  --form &quot;return_type=\&quot;site2map\&quot;&quot; \   
  --form &quot;legend_pos=\&quot;bottom\&quot;&quot;   </code></pre>
<hr />
</div>
<div id="response" class="section level2">
<h2>Response</h2>
<div class="figure">
<img src="img/ex01_resp.png" alt="" />
<p class="caption">Bioquery site2map with polygonal region</p>
</div>
<hr />
</div>
</div>
<div id="open-api.02" class="section level1 tabset tabset-fade tabset-pills">
<h1>Open API.02</h1>
<hr />
<div id="post-1" class="section level2">
<h2>POST</h2>
<hr />
<p><a name="api02">keyword: </a> <em>bioquery upload user data</em></p>
<p><strong>API cURL url: </strong><a href="https://bio.odb.ntu.edu.tw/api/bioquery/png" class="uri">https://bio.odb.ntu.edu.tw/api/bioquery/png</a> {jpeg, pdf, svg}</p>
<p>Users can upload community abundance data of species assemblages, which<br />
can be combined with ODB data (by ‘config’ parameter). This combined<br />
data then can be used in various statistics or plotting according to<br />
‘return_type’ parameter. Data format and rules of combination see:<br />
<a href="https://bio.odb.ntu.edu.tw/query/?help=user_data" class="uri">https://bio.odb.ntu.edu.tw/query/?help=user_data</a></p>
<hr />
</div>
<div id="body-1" class="section level2">
<h2>Body</h2>
<hr />
<p><span class="docs-request-body__mode push-half--left">formdata</span></p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td>
config
</td>
<td>
<div class="pm-markdown docs-request-table__desc">
<p>
Query crieteria from bio.odb.ntu.edu.tw/query, or a config text, json, or yaml file.
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
return_type
</td>
<td>
“site2map”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
return data type, here, “site2map” can return png, jpeg, svg, or pdf
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
datasrc
</td>
<td>
<div class="pm-markdown docs-request-table__desc">
<p>
Abundance data csv file of species assemblages. Data format see: <a href="https://bio.odb.ntu.edu.tw/query/?help=user_data">https://bio.odb.ntu.edu.tw/query/?help=user_data</a>
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
data_mode
</td>
<td>
“combine”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Specify how user data combined with ODB data (from config): “indep”, “combine”, “combine_region” or “site”. Details see:<a href="https://bio.odb.ntu.edu.tw/query/?help=user_data">https://bio.odb.ntu.edu.tw/query/?help=user_data</a>
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
data_id
</td>
<td>
“taxon”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Specify the variable name in datasrc which means species identification (default: “taxon”)
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
data_val
</td>
<td>
“taxon_count”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Specify the variable name in datasrc which means species abundance or occurrence (default: “taxon_count”)
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
data_group
</td>
<td>
“polyID”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Specify the grouping variable name in datasrc (default: “polyID”, polygonal region ID in integer)
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
geopoly
</td>
<td>
<div class="pm-markdown docs-request-table__desc">
<p>
Optional. Can be file specified longitude and latitude of polygonal regions with id, as format “csv_poly” in this example, or a character vector contains geometry text with format “lonlat_poly”, bounding box with format “BBOX” (see next example), or BioQuery downloaded query text file with format “bioquery”.
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
format
</td>
<td>
“csv_poly”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional but needed if specify geopoly: “csv” (CSV file with coordinates in geopoly parameter), “csv_poly” (CSV wity column of polygonal ID), “bioquery” (Config file downloaded from BioQuery: bio.odb.ntu.edu.tw/query), “bbox” (bounding box), “lonlat_poly” (string format in geopoly parameter to specify polygonal region, such as geopoly=“(124,125,124.5,124,20,21,22,20);(120,121,122,122.5,120,19,20,22,22,19)”), “kml” (KML file).
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
grd_sel
</td>
<td>
1<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional. Specify grid for data gridding: null (raw data), 0 (0.25-deg), 1 (0.5-deg, default), 2 (1-deg)
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
include_poly0
</td>
<td>
false<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional. Enable analysis including polyID==0, i.e., also analysis those sites which are outside the given polygonal regions (default: FALSE).
</p>
</div>
</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="curl-1" class="section level2">
<h2>cURL</h2>
<p><span class="docs-example__snippet-type"><a name="curl02">Example Request: </a></span><span class="docs-example__response-title" title="bioquery upload user data">bioquery upload user data</span></p>
<pre><code>curl --location --request POST &quot;https://bio.odb.ntu.edu.tw/api/bioquery/png&quot; \   
  --form &quot;config=@Your_File_Path&quot; \
  --form &quot;return_type=\&quot;site2map\&quot;&quot; \   
  --form &quot;datasrc=@Your_File_Path&quot; \
  --form &quot;data_mode=\&quot;combine\&quot;&quot; \   
  --form &quot;data_id=\&quot;taxon\&quot;&quot; \   
  --form &quot;data_val=\&quot;taxon_count\&quot;&quot; \   
  --form &quot;data_group=\&quot;polyID\&quot;&quot; \   
  --form &quot;geopoly=@Your_File_Path&quot; \
  --form &quot;format=\&quot;csv_poly\&quot;&quot; \   </code></pre>
<hr />
</div>
<div id="response-1" class="section level2">
<h2>Response</h2>
<div class="figure">
<img src="img/ex02_resp.png" alt="" />
<p class="caption">User data combined with ODB data with regions respectively</p>
</div>
<hr />
</div>
</div>
<div id="open-api.03" class="section level1 tabset tabset-fade tabset-pills">
<h1>Open API.03</h1>
<hr />
<div id="post-2" class="section level2">
<h2>POST</h2>
<hr />
<p><a name="api03">keyword: </a> <em>bioquery overlay environmental layer</em></p>
<p><strong>API cURL url: </strong><a href="https://bio.odb.ntu.edu.tw/api/bioquery/png" class="uri">https://bio.odb.ntu.edu.tw/api/bioquery/png</a> {jpeg, pdf, svg}</p>
<p>Environmental (Env) factors can be specified or uploaded and used in<br />
succeeding analysis. Specify ‘envsrc’ which means various sources of env<br />
databases compiled by ODB, and ‘env_layer’, i.e., the env factors<br />
contained in this source. Each env-layer can be applied with spatially<br />
kriging, transformed, and scaled. Details see:<br />
<a href="https://bio.odb.ntu.edu.tw/query/?help=bioenv" class="uri">https://bio.odb.ntu.edu.tw/query/?help=bioenv</a></p>
<hr />
</div>
<div id="body-2" class="section level2">
<h2>Body</h2>
<hr />
<p><span class="docs-request-body__mode push-half--left">formdata</span></p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td>
config
</td>
<td>
<div class="pm-markdown docs-request-table__desc">
<p>
Query crieteria from bio.odb.ntu.edu.tw/query, or a config text, json, or yaml file.
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
return_type
</td>
<td>
“site2map”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
return data type, here, “site2map” can return png, jpeg, svg, or pdf
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
env_layer
</td>
<td>
“chl”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Environmental layer name that used in the specified “envsrc”. See BioQuery: bio.odb.ntu.edu.tw/query to find all options for env_layer.
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
envsrc
</td>
<td>
“nasa_neo”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Environmental source, either a file with longitude/latitude/(season)/env_layer, or a env database provided (or compiled) by ODB, NTU. Here “nasa_neo” means NASA NEO env data, and we fetch SST data. See BioQuery: bio.odb.ntu.edu.tw/query to find all options for envsrc.
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
by_season
</td>
<td>
true<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional. Plot with seasonality facets, if “season” in specified “envsrc”. (default is true)
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
scale_res
</td>
<td>
“large”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional. Coastline resolution: “small”, “medium”, “large”
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
getenv_options
</td>
<td>
‘{"en_trans":["1"], "scale_fun":["log"], "scale_mul":["1000"], "en_kriging":["0"]}’<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional. Json string that specify env_layer need transformation (en_trans: 1/0) by multipling a factor (scal_mul), by functions (scale_fun: “log”, “sqrt”, “exp”,…), or kriging (en_kriging: 1/0). Note: kriging is time-consuming
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
geopoly
</td>
<td>
“BBOX (110,15,130,35)”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional. Plot map within a bounding box
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
format
</td>
<td>
“bbox”<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional but needed if specify geopoly: “csv” (CSV file with coordinates in geopoly parameter), “csv_poly” (CSV wity column of polygonal ID), “bioquery” (Config file downloaded from BioQuery: bio.odb.ntu.edu.tw/query), “bbox” (bounding box), “lonlat_poly” (string format in geopoly parameter to specify polygonal region, such as geopoly=“(124,125,124.5,124,20,21,22,20);(120,121,122,122.5,120,19,20,22,22,19)”), “kml” (KML file).
</p>
</div>
</td>
</tr>
<tr class="even">
<td>
en_poly_border
</td>
<td>
false<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional. Plot outlines of polygonal region or not.
</p>
</div>
</td>
</tr>
<tr class="odd">
<td>
enlarge_poly_bbox
</td>
<td>
false<br />

<div class="pm-markdown docs-request-table__desc">
<p>
Optional . Enlarge plotting content to include bounding box inside.
</p>
</div>
</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="curl-2" class="section level2">
<h2>cURL</h2>
<p><span class="docs-example__snippet-type"><a name="curl03">Example Request: </a></span><span class="docs-example__response-title" title="bioquery overlay environmental layer">bioquery overlay environmental layer</span></p>
<pre><code>curl --location --request POST &quot;https://bio.odb.ntu.edu.tw/api/bioquery/png&quot; \   
  --form &quot;return_type=\&quot;site2map\&quot;&quot; \   
  --form &quot;env_layer=\&quot;chl\&quot;&quot; \   
  --form &quot;envsrc=\&quot;nasa_neo\&quot;&quot; \   
  --form &quot;by_season=true&quot; \   
  --form &quot;scale_res=\&quot;large\&quot;&quot; \   
  --form &quot;getenv_options=&#39;{\\\&quot;en_trans\\\&quot;:[\\\&quot;1\\\&quot;], \\\&quot;scale_fun\\\&quot;:[\\\&quot;log\\\&quot;], \\\&quot;scale_mul\\\&quot;:[\\\&quot;1000\\\&quot;], \\\&quot;en_kriging\\\&quot;:[\\\&quot;0\\\&quot;]}&#39;&quot; \   
  --form &quot;geopoly=\&quot;BBOX (110,15,130,35)\&quot;&quot; \   
  --form &quot;format=\&quot;bbox\&quot;&quot; \   
  --form &quot;en_poly_border=false&quot; \   </code></pre>
<hr />
</div>
<div id="response-2" class="section level2">
<h2>Response</h2>
<div class="figure">
<img src="img/ex03_resp.png" alt="" />
<p class="caption">SST, or other env layer overlay on map with seasonality</p>
</div>
<hr />
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
